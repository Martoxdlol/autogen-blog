---
import {
    Author,
    getAuthor,
    getAuthors,
    getCategories,
    getPosts,
} from "../../data/data";
import { firestore } from "../../data/config";
import Layout from "../../layouts/Layout.astro";
import {
    defaultLangSingleRoutePaths,
    multiLangSingleRoutePaths,
} from "../../util/util";
import { generateTopics } from "../../data/generators";

export const getStaticPaths = multiLangSingleRoutePaths(["es", "en", "fr"]);

// const categories = await getCategories()
// const posts = await getPosts(categories[0].id)

const authors = await getAuthors();
const categories = (await getCategories()).sort((a, b) =>
    a.name.localeCompare(b.name)
);

// console.log((await firestore.collection("posts").get()).docs)

// console.log(posts)

const authorsMap = new Map<string, Author>();

for (const author of authors) {
    authorsMap.set(author.id, author);
}
---

<Layout title="Autogen Blog">
    <div class="content">
        <h1>Autogenerated content blog</h1>
        <hr />
        <h2>Posts on categories</h2>
        <ul>
            {
                categories.map(async (category) => {
                    const posts = (await getPosts(category.id)).sort((a, b) =>
                        a.title.localeCompare(b.title)
                    );
                    return (
                        <li>
                            <div>
                                <h3>{category.name}</h3>
                                <ol>
                                    {posts.map((post) => {
                                        const author = authorsMap.get(
                                            post.author
                                        );

                                        return (
                                            <li>
                                                <p>
                                                    <a
                                                        href={`/${post.lang}/${category.slug}/${post.slug}`}
                                                    >
                                                        {post.title}
                                                    </a>
                                                    <br />
                                                    {author && (
                                                        <>
                                                            by{" "}
                                                            <b>{author.name}</b>
                                                            .{" "}
                                                        </>
                                                    )}
                                                    Language: <b>{post.lang}</b>
                                                </p>
                                            </li>
                                        );
                                    })}
                                </ol>
                            </div>
                        </li>
                    );
                })
            }
        </ul>
        <h2>All authors</h2>
        <ul>
            {
                authors
                    .sort((a, b) => a.name.localeCompare(b.name))
                    .map((author) => (
                        <li>
                            {author.name} (<b>{author.lang}</b>)
                        </li>
                    ))
            }
        </ul>
        <hr />
        <p>Created with AI</p>
        <p>
            Made by <b>Tom√°s Cichero</b> - See <a
                href="https://github.com/Martoxdlol/autogen-blog">Github repo</a
            >
        </p>
    </div>
</Layout>
